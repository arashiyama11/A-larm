## A-larm 仕様書

A-larmはAIを活用した目覚ましアプリです。ユーザーが設定した理想の生活習慣に基づいて、AIが起床を促す会話を行います。

- ユーザーは理想の生活習慣を入れておく
    - 週単位か1日単位
- 起きる時間になったらアラームとして起動して、AIが喋りかけてくる
- AIのキャラを設定できる。LLMのAPIキーはユーザーに入力させる方式を想定
- APIキーは暗号化ストレージに保存し、ログ出力などしないように気を付ける

- 単に会話を続けた時間ベースで起床判定をする

- LLMの応答が遅い時だとかTTSに失敗した時は、単なるアラームにするか固定のセリフでフォールバック

- 会話動線をどうするか
    - 初回のLLM側の発話が長いと聞き流して二度寝しそう
    - ユーザーに発話させるのが確実な起床につながると思うので質問ファーストがいいかな
    - ユーザーからの応答がない場合はどうするのか
        - アプリ側で音量は上げることができそう
        - ねぇ聞いてよって感じの呼びかけをする

- LLMとの対話パラメータ v0
    - 起きた判定: ユーザーの1分以上の発話
    - ユーザーの90秒以上の沈黙で二度寝判定
    - LLMが喋っている最中でもユーザーの入力を優先
    - ユーザーの最後の発話から2s経過でLLMに応答を促す

- [llm,tts] AIのキャラづけをどこまでやるか
    - 声質は変えるのか
    - 口調や話題生成のプロンプトは変えるのか
    - キャラクターのプロフィールやバックストーリーを持たせるのか
    - ユーザーの過去の会話履歴を持っておくのか

- [優先度低] Googleカレンダーから予定とかを引っ張ってプロンプトにのせる
- [優先度低] そろそろ寝ろよって言う機能もあってもいい

## UI

1. オンボーディング画面
    - アプリの説明
    - 権限要求
    - LLMのAPIキー入力

2. ホーム画面
    - 次回アラーム時間の可視化
    - アラームの有効/無効切り替え
    - 3,4へのリンク

3. 設定画面
    - アラームのキャラクター選択やカスタム
    - TTS視聴もあるといい
    - 言語/ロケール、APIキー管理、通知/音量、プライバシー、データ削除

4. ルーチーン入力画面
    - 理想の生活習慣を入力
    - 週単位か1日単位で設定
    - 朝のタスク入力とか

5. 起床セッション
    - LLMとの対話画面
    - マイク入力状態、現在入力中かどうかはわかるようにする
    - フォールバックの純アラーム
